name: MQTT_DHT-22

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install PlatformIO
        run: python -m pip install --upgrade pip platformio
      - name: Run native tests
        run: platformio test -e native_test

  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install clang-format
        run: sudo apt-get update && sudo apt-get install -y clang-format
      - name: Check formatting
        run: |
          clang-format --version
          clang-format --dry-run --Werror \
            src/*.cpp src/*/*.cpp \
            include/*.h include/*/*.h \
            test/*/*.cpp
